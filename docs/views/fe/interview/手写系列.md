---
title: å‰ç«¯åŸºç¡€ - æ‰‹å†™ç³»åˆ—
sidebar: 'auto'
date: 2020-12-03
tags:
 - åŸºç¡€
categories:
 - å‰ç«¯
---

> ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ ğŸ•µğŸ•µğŸ•µ

<!-- more -->


## å®ç° callã€applyã€bind

### call
```
function myCall(ctx = window, ...args) {
  ctx = ctx || window;
  // ä¸ºcontext åˆ›å»ºä¸€ä¸ª Symbolï¼ˆä¿è¯ä¸ä¼šé‡åï¼‰å±æ€§ï¼Œå°†å½“å‰å‡½æ•°èµ‹å€¼ç»™è¿™ä¸ªå±æ€§
  const fn = Symbol();
  ctx[fn] = this;
  // å¤„ç†å‚æ•°ï¼Œä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°åçš„å…¶ä½™å‚æ•°
  const res = ctx[fn](...args);
  // è°ƒç”¨å‡½æ•°åå³åˆ é™¤è¯¥Symbolå±æ€§
  delete ctx[fn];
  return res;
}
```
### apply

```
function myApply(ctx = window, args) {
  ctx = ctx || window;
  const fn = Symbol();
  ctx[fn] = this;
  if (Array.isArray(args)) {
    result = ctx[fn](...args);
  } else {
    result = ctx[fn]();
  }
  delete ctx[fn];
  return res;
}
```
### bind
```
function myBind(ctx, ...args1) {
  const _this = this;
  return function F(...args2) {
    if (this instanceof F) {
      // åˆ¤æ–­æ˜¯å¦ä¸ºæ„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœæ˜¯åˆ™ä½¿ç”¨newè°ƒç”¨å½“å‰å‡½æ•°
      return new _this(...args1, ...args2)
    } else {
      // å¦‚æœä¸æ˜¯ï¼Œä½¿ç”¨applyï¼Œå°†contextå’Œå¤„ç†å¥½çš„å‚æ•°ä¼ å…¥
      return _this.apply(ctx, args1.concat(args2))
    }
  }
}
```

## å®ç°å‘å¸ƒè®¢é˜…ã€è§‚å¯Ÿè€…æ¨¡å¼

[è§‚å¯Ÿè€…æ¨¡å¼ä¸è®¢é˜…å‘å¸ƒæ¨¡å¼çš„åŒºåˆ«](https://www.cnblogs.com/onepixel/p/10806891.html)

`ä¸€å¥è¯æ€»ç»“ï¼š å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ˜¯é¢å‘è°ƒåº¦ä¸­å¿ƒç¼–ç¨‹çš„ï¼Œè€Œè§‚å¯Ÿè€…æ¨¡å¼åˆ™æ˜¯é¢å‘ç›®æ ‡å’Œè§‚å¯Ÿè€…ç¼–ç¨‹çš„ã€‚å‰è€…ç”¨äºè§£è€¦å‘å¸ƒè€…å’Œè®¢é˜…è€…ï¼Œåè€…ç”¨äºè€¦åˆç›®æ ‡å’Œè§‚å¯Ÿè€…`

## å‘å¸ƒè®¢é˜…

```
class PubSub{
  constructor() {
    this.subscribers = [];
  }
  subscribe (topic, callback) {
    let callbacks = this.subscribers[topic]
    if(!callbacks) {
      this.subscribers[topic] = [callback]
    } else {
      callbacks.push(callback)
    }
  }

  publish(topic, ...args) {
    let callbacks = this.subscribers[topic] || [];
    callbacks.forEach(callback => callback(...args))
  }
}

function aEvent(num) {
  console.log('aEvent:'+num);
}
function bEvent(num) {
  console.log('bEvent:'+num);
}

let pubSub = new PubSub();

pubSub.subscribe('aaa', aEvent)

pubSub.subscribe('bbb', bEvent)

pubSub.publish('aaa', '11111111')

pubSub.publish('bbb', '11111111')
```
### è§‚å¯Ÿè€…æ¨¡å¼

```
class Subject {
  constructor() {
    this.observers = [];
  }
  add(observer) {
    this.observers.push(observer)
  }

  notify(...args) {
    this.observers.forEach(observer => observer.update(...args))
  }
}

class Observer {
  update(...args) {
    console.log(...args);
  }
}

// åˆ›å»ºè§‚å¯Ÿè€…ob1
let ob1 = new Observer();
// åˆ›å»ºè§‚å¯Ÿè€…ob2
let ob2 = new Observer();
// åˆ›å»ºç›®æ ‡sub
let sub = new Subject();
// ç›®æ ‡subæ·»åŠ è§‚å¯Ÿè€…ob1 ï¼ˆç›®æ ‡å’Œè§‚å¯Ÿè€…å»ºç«‹äº†ä¾èµ–å…³ç³»ï¼‰
sub.add(ob1);
// ç›®æ ‡subæ·»åŠ è§‚å¯Ÿè€…ob2
sub.add(ob2);
// ç›®æ ‡subè§¦å‘SMSäº‹ä»¶ï¼ˆç›®æ ‡ä¸»åŠ¨é€šçŸ¥è§‚å¯Ÿè€…ï¼‰
sub.notify('I fired `SMS` event');
```